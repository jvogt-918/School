---
title: "DDS 6306 Case Study 2 - Crab Age Prediction"
author: "Michael Flores & Johnny Vogt"
date: "2025-04-12"
output: html_document
---

```{r}

#Executive Summary
##This project focuses on predictive modeling and exploratory data analysis to support biological research on crab aging. The primary objective is to build a robust regression model that minimizes the Mean Absolute Error (MAE) on a designated competition test set. In parallel, the analysis aims to uncover key features that most significantly correlate with crab age, providing deeper biological insights through statistical interpretation.

###To support these goals, the project will deliver:
###1. An interactive RShiny application that enables users to visually explore relationships between crab age and measured features.
###2. A comprehensive RMarkdown report detailing the data cleaning process, modeling approach, and key analytical findings.
###3. Age predictions for the test dataset to be evaluated in the competition.
###4. A GitHub repository containing all code, documentation, and supporting materials.
###5. A 7-minute presentation video summarizing the project objectives, methodology, and results.

#Load Libraries
library(ggplot2)
library(tidyverse)
library(tidyr)
library(dplyr)
library(class)
library(caret)
library(GGally)
library(corrplot)

#Load dataset
crab_age = read.csv("C:/Users/Mike Flores/OneDrive/Documents/000SMU/6306_Doing Data Science/CSProject02/crab_age.csv", header = TRUE)

#List first few rows of dataframe
head(crab_age)

#Delete unnecessary columns
##Remove ID
crab_age$id <- NULL

#Removing the zeros for Height and Diameter
clean_crab_age <- crab_age %>%
  filter(Height != 0, Diameter != 0)

#Compute categorical averages and grouped by Age. To perform exploratory data analysis (EDA) to reveals how different physical features of crabs vary as they age.
ageavg <- crab_age %>%
  group_by(Age) %>%
  summarize(
    avg_length     = mean(Length, na.rm = TRUE),
    avg_diameter   = mean(Diameter, na.rm = TRUE),
    avg_height     = mean(Height, na.rm = TRUE),
    avg_weight     = mean(Weight, na.rm = TRUE),
    avg_shweight   = mean(Shucked.Weight, na.rm = TRUE),
    avg_visweight  = mean(Viscera.Weight, na.rm = TRUE),
    avg_shlweight  = mean(Shell.Weight, na.rm = TRUE),
    .groups = "drop"
  )

#Reshape ageavg to long format
ageavg_long <- ageavg %>%
  pivot_longer(
    cols = -Age,
    names_to = "Feature",
    values_to = "Average"
  )

#Faceted line plots
ggplot(ageavg_long, aes(x = Age, y = Average)) +
  geom_line(color = "blue") +
  geom_point() +
  facet_wrap(~ Feature, scales = "free_y") +
  labs(title = "Average Feature Values by Crab Age", x = "Age", y = "Average Value") +
  theme_minimal()

#Compute categorical averages and grouped by Sex. To perform exploratory data analysis (EDA) to reveals how different physical features of crabs vary based on their gender.
sexavg <- crab_age %>%
  group_by(Sex) %>%
  summarize(
    avg_age = mean(Age, na.rm = TRUE),
    avg_length = mean(Length, na.rm = TRUE),
    avg_diameter = mean(Diameter, na.rm = TRUE),
    avg_height = mean(Height, na.rm = TRUE),
    avg_weight = mean(Weight, na.rm = TRUE),
    avg_shweight = mean(Shucked.Weight, na.rm = TRUE),
    avg_visweight = mean(Viscera.Weight, na.rm = TRUE),
    avg_shlweight = mean(Shell.Weight, na.rm = TRUE),
  )

#Reshape sexavg to long format
sexavg_long <- sexavg %>%
  pivot_longer(
    cols = -Sex,
    names_to = "Feature",
    values_to = "Average"
  )

#Plot: Bar Chart with facets
ggplot(sexavg_long, aes(x = Sex, y = Average, fill = Sex)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ Feature, scales = "free_y") +
  labs(title = "Average Crab Features by Sex", x = "Sex", y = "Average Value") +
  theme_minimal()

#Create a Scatter Plot matrix (pair plots) for all numeric columns in the crab_age data frame.
crab_age %>% 
  ggpairs()
 
#Create Box Plots for Sex vs each other variable.
crab_age %>%
  ggplot(aes(y = Sex, x = Length)) +
  geom_boxplot()

crab_age %>%
  ggplot(aes(y = Sex, x = Diameter)) +
  geom_boxplot()

crab_age %>%
  ggplot(aes(y = Sex, x = Height)) +
  geom_boxplot()

crab_age %>%
  ggplot(aes(y = Sex, x = Weight)) +
  geom_boxplot()

crab_age %>%
  ggplot(aes(y = Sex, x = `Shucked.Weight`)) +
  geom_boxplot()

crab_age %>%
  ggplot(aes(y = Sex, x = `Viscera.Weight` )) +
  geom_boxplot() 

crab_age %>%
  ggplot(aes(y = Sex, x= `Shell.Weight`)) +
  geom_boxplot()

crab_age %>%
  ggplot(aes(y = Sex, x= Age)) +
  geom_boxplot()

#Linear Regression Model to Predict the Age of a Crab Based on Various Physical Features
##Model training.
crab_age_model <- lm(Age ~ Length + Diameter + Height + Weight + Sex, data = crab_age)
##Model predicting.
predictions <- predict(crab_age_model, newdata = crab_age)
#Mean Absolute Error (MAE) for the regression model.
mean(abs(crab_age$Age - predictions))

#####
#####
#####
##### This is where i stopped



#Creating Train set and a Test set and a loop to

iterations_crab = 500

masterMAE_crab = matrix(nrow = iterations_crab)

splitPerc_crab = .7 #Training / Test split Percentage

for(j in 1:iterations_crab)
{
  #Creating Sample at a 70% and %30 Split
  trainIndices_crab = sample(1:dim(crab_age)[1],round(splitPerc_crab * dim(crab_age)[1]))
  train_crab = crab_age[trainIndices_crab,]
  test_crab = crab_age[-trainIndices_crab,]
  model_crab = lm(Age ~ Length + Diameter + Height + `Shell.Weight` + Sex, data = train_crab)
  #Mean Average Error
  predictions_crab = predict(model_crab, newdata = test_crab)
  masterMAE_crab[j] = mean(abs(test_crab$Age - predictions_crab))
}

MeanMAE_crab = colMeans(masterMAE_crab)
MeanMAE_crab

crab_age %>% 
  ggplot(aes(y = Age, x = `Shucked.Weight`)) +
  geom_point(position = "jitter") +
  geom_smooth(method = "lm")























```
